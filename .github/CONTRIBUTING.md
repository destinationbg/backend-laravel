# Наръчник на доброволеца

Здравейте! Много се радвам, че проявявате интерес в това да допринесете за разработката на този проект. Преди обаче да го направите, ви моля да отделите няколко минути от времето си, за да се запознаете с начина, по който работим:

1. [Етичен кодекс](./CODE_OF_CONDUCT.md)
1. [Настройка на средата за разработка](#настройка-на-средата-за-разработка)
1. [Преди започване на работа по приложението](#преди-започване-на-работа-по-приложението)
1. [Подаване на промените към нашето хранилище](#подаване-на-промените-към-нашето-хранилище)
1. [Докладване на проблеми](#докладване-на-проблеми)

---

## Настройка на средата за разработка

За работата на Laravel приложението, е нужно да имате инсталирани [Node.js](https://nodejs.org) (**версия 19.6** или по-нова), [Composer](https://getcomposer.org/download/) (**версия 2.5** или по-нова) и [Docker Compose](https://docs.docker.com/compose/), тъй като проекта работи изцяло в Docker контейнер и вътрешно сваля допълнителния нужен софтуер за работа на Laravel приложението, а по-точно - PHP, nginx, MySQL, Redis и т.н.

За да успеете да подкарате приложението, то изисква да разполагате и със статичното съдържание за всяка забележителност, категория и туристически район. То е налично тук чрез директорията `/storage/app/static-contents`. Промените във файловете обаче се извършват от [static-contents](https://github.com/placesbg/static-contents) хранилището и впоследствие се синхронизират тук, така че не правете промени директно от това приложение.

Ако за първи път ще работите върху това приложение, първо трябва да [копирате нашето Laravel хранилище във вашия GitHub профил](https://github.com/placesbg/backend-laravel/fork) чрез Fork функцията, както и хранилището, което съдържа [статичното съдържание](https://github.com/placesbg/static-contents/fork). След това трябва да клонирате вашето собствено Laravel хранилище в локалната ви среда чрез `git clone` командата и да въведете следните команди в последователен ред, както е показано:

```bash
# прави копие на .env.example файла и го кръщава .env
cp .env.example .env
```

Преди да продължим с командите, ви спирам тук, за да ви насоча към новосъздадения `.env` файл. Отворете го и намерете променливата `APP_STATIC_CONTENTS`. Линка срещу нея трябва да отговаря на **ВАШЕТО** копие на [статичното съдържание](https://github.com/placesbg/static-contents), така че това е първото нещо, което трябва да промените.

Разгледайте останалите настройки и нанесете корекции по конфигурацията, така че да отговаря на средата, от която работите. Ако има нужда, разбира се.

Сега нека продължим с командите:

```bash
# инсталира всички нужни Composer пакети, които се отнасят за back-end частта в приложението
composer install

# стартира локално Docker контейнер и пуска софтуера, който е нужен за работата на Laravel приложението
sail up -d

# инсталира всички нужни Node.js пакети, които се отнасят за front-end частта в приложението
sail npm install

# налива от нулата всички предварително подготвени данни в базата
sail artisan migrate:fresh --seed

# извлича и попълва в базата данни статичното съдържание за забележителностите, категориите и туристическите райони
sail artisan landmarks:fetch

# стартираа уеб сървъра и автоматичното компилиране на всички ресурси в реално време
sail npm run dev
```

Вече може да отворите приложението от адрес [https://localhost:8000/](https://localhost:8000/).

ВАЖНО: Имайте предвид, че всички забележителности, категории и туристически райони по подразбиране ще се налеят в базата данни с неактивен статус, което ще рече, че отпред в Nuxt 3 приложението няма да е налично нищо за показване. Трябва да отворите административния панел от линка по-горе и да промените статуса на всяко нещо, което искате да бъде видимо и отпред в Nuxt-a.

## Преди започване на работа по приложението

Всеки път преди да започнете работа по приложението, трябва да сте сигурни, че разполагате с последните промени от нашето хранилище. За целта отворете GitHub страницата на вашето хранилище и кликнете на **Sync fork** бутона над списъка с файлове. Отворете командния ред или терминал от вашата операционна система и изпълнете следната команда:

```bash
# извлича последните промени, които вашето локално копие все още не съдържа
git pull
```

Следва да актуализирате файловете от статичното съдържание за забележителностите. За да вземете промените и да ги налеете локално в базата на приложението ви, изпълнете тези команди:

```bash
# стартира локално Docker контейнер и пуска софтуера, който е нужен за работата на Laravel приложението
sail up -d

# извлича и попълва в базата данни статичното съдържание за забележителностите, категориите и туристическите райони
sail artisan landmarks:fetch

# стартираа уеб сървъра и автоматичното компилиране на всички ресурси в реално време
sail npm run dev
```

Ето няколко важни насоки преди да започнете същественото писане на код:

- Работете само върху файловете, които **не са част** от изброените директории и файлове в `.gitignore`.

- Commit-вайте редовно промените си към вашето хранилище.

- Съвсем нормално е да имате много на брой commit-и, които да съдържат малко или почти никакви съществени промени по кода, затова не чакайте да напишете всичко от-до преди да го commit-нете към вашето хранилище.

- Ако ще работите върху изцяло нова функционалност:
  - Първо се допитайте до нашето мнение преди да го направите. Напишете убедителна причина защо предлагате да добавите тази функционалност в проекта, като [отворите issue](https://github.com/placesbg/backend-laravel/issues/new) и изчакате одобрение от екипа.
  - Щом получите одобрение, започнете разработка и се погрижете да включите и тестове, които да покриват напълно новата ви функционалност.

- Ако ще поправяте бъг:
  - Първо проверете дали има [отворено issue](https://github.com/placesbg/backend-laravel/issues) по темата и дали някой друг вече не работи по този казус.
  - Ако никой не работи по това, което сте открили, и искате вие да го оправите, [отворете ново issue](https://github.com/placesbg/backend-laravel/issues/new) и опишете добре детайлите на бъга и ако е възможно, дори оставете линк към публична демонстрация - било то на ваш хостинг или в ограничена среда.
  - Когато commit-вате промените, които оправят проблема, не забравяйте в съобщението да напишете `(fix #xxxx[,#xxxx])` (#xxxx е номера на issue-то), за да ни бъде по-лесно да разберем какво точно оправяте и да създаем списък с промени, когато отразим всичко в нов release. Пример за съобщение: `update entities encoding/decoding (fix #3899)`.

## Подаване на промените към нашето хранилище

### Стъпка 1 - форматиране на кода

Без значение какъв текстови редактор използвате, преди да пуснете промените си към вашето хранилище, се уверете, че кода ви отговаря на конвенциите и най-добрите световни практики, като изпълните още няколко команди. Те помагат в това отношение да "оправят" дребни проблемни фрагменти във вашия код. За целта използваме linters & formatters в приложението, за да сме сигурни, че кода изглежда еднакво добре като подредба и стилистика при всички.

За да форматирате и поправите автоматично всички проблемни фрагменти от вашия код, изпълнете командите, завършващи с `fix` отзад или изпълнете алтернативните, ако желаете само да проверите какви са проблемните фрагменти, но без да ги коригирате.

Само за проверка:

```bash
npm run lint
npm run lint:eslint
npm run lint:prettier
npm run lint:stylelint
npm run lint:pint
```

За директна и автоматична корекция:

```bash
npm run lint:fix
npm run lint:eslint:fix
npm run lint:prettier:fix
npm run lint:stylelint:fix
npm run lint:pint:fix
npm run lint:blade:fix
```

### Стъпка 2 - тестване на кода

Нашето хранилище има настроено CI/CD, което извършва тестове всеки път щом пристигнат нови промени в `dev` branch-а. Ако там всичко мине без грешки, промените остават в изчакване за прехвърляне към `main` branch-a, а когато стигнат там, то те се качват автоматично на продуктова среда.

За да сме сигурни, че pipeline-а на CI/CD-то ще премине без проблеми, е желателно още на локална среда да пускате тестове, за да проверите изправността на приложението преди да преминете към стъпката за създаване на Pull Request към нашето хранилище. По този начин, ако нещо се счупи на локална среда при вас, ще можете да реагирате мигновено и да го поправите преди проблемите да стигнат до нашето хранилище. Колкото по-рядко CI/CD-то открива проблеми, толкова по-бързо промените ще достигат до реалната продуктова среда.

За да тествате кода на локална среда, изпълнете следните команди в последователен ред, както е показано:

```bash
sail artisan test -p

sail artisan dusk:chrome-driver
php artisan dusk --pest
```

### Стъпка 3 - качване на промените във вашето хранилище (Commit)

Уверете се, че когато commit-вате, го правите с правилния Git потребител. Това спомага за по-правилната идентификация кои хора работят върху проекта и автоматично включва вашето име в списъка с допринесли за разработката на проекта.

За целта може директно да презапишете потребителя и имейла за това хранилище с правилните ви GitHub данни по следния начин:

```bash
git config user.name "вашият-github-потребител"
git config user.email "вашият-github-имейл"
```

След това преминете към самото commit-ване. Съобщението, което ще използвате за `git commit` командата, трябва да следва [нашата конвенция](./COMMIT_CONVENTION.md). Следването ѝ спомага за автоматичното генериране на списък с промени (changelog) и дава по-голяма яснота какво точно е променено с този commit.

```bash
# добавяне на всички променени файлове към списъка за commit-ване
git add .

# създаване на самия commit със съобщение относно промените
git commit -m "кратко съобщение, следващо нашите конвенции"

# изпращане на промените към вашето GitHub хранилище
git push
```

### Стъпка 4 - подаване на промените към нашето хранилище (Pull Request)

Посредством технологията Git, която уебсайта GitHub използва, всяко хранилище бива разделено на продуктови среди, които ние наричаме с думата **branch**. Нашият проект има две активни продуктови среди, които съдържат различи версии на сайта ни.
- `main` средата съдържа всичко, което виждате на сайта (последно одобрените промени влизат в този branch);
- `dev` средата съдържа новите промени, които обаче трябва да бъдат прегледани преди да бъдат преместени в `main` и да се отразят на сайта.

В този ред на мисли промените, които вие правите, трябва **винаги** да отиват в `dev` branch-а, затова трябва да правите проверка от кой branch към кой branch ще подадете промените си. **НИКОГА** не подавайте промени към **main** branch-a!

Когато сметнете, че направените промени във вашето хранилище са готови за предаване, следва да ги изпратите към нашето хранилище чрез Pull Request функционалността на Git. След което ние ще ги прегледаме и ще ги задвижим по-напред, ако всичко е наред.

За целта отворете GitHub страницата на вашето хранилище и кликнете на **Contribute** бутона над списъка с файлове. Проверете branch-овете, напишете кратко заглавие и описателен текст относно промените, които сте правили.

Уверете се, че опцията **Allow edits by maintainers** е активирана.

## Докладване на проблеми

Винаги използвайте [https://github.com/placesbg/backend-laravel/issues/new](https://github.com/placesbg/backend-laravel/issues/new), за да създадете ново issue и да обясните какво не е наред, ако не възнамерявате сами да го оправяте.

---

## Финансов принос

Като проект, управляван изцяло доброволно от общността, без голяма корпоративна подкрепа зад гърба си, приветстваме финансова помощ чрез [GitHub Sponsors](https://github.com/sponsors/placesbg) и [OpenCollective](https://opencollective.com/placesbg) страниците.

Предварително благодарим на всеки, който допринесе финансово за поддръжката и развитието на проекта! В изображението отдолу се съдържат аватарите на всички хора, които вече допринесоха.

<a href="https://opencollective.com/placesbg"><img src="https://opencollective.com/placesbg/contributors.svg?width=890" /></a>
